"use strict";!function(e,t){var n={},r=_.throttle((function(){return _.chain(document.cookie.split("; ")).reduce((function(e,t){var n=t.split("=");return e[n[0]]=n[1],e}),{}).value()}),500);function o(e){return moment(e).utc().format("ddd, DD MMM YYYY HH:mm:ss z")}n.KeyExists=function(e){return _.has(r(),e)},n.Delete=function(e){n.Set(e,null,o(moment().add(-1,"days")))},n.Get=function(e){if(!n.KeyExists(e))throw"Key not set: "+e;return r()[e]},n.Set=function(e,t,n,r){var i=[e+"="+t];return(_.isNull(t)||_.isUndefined(t)||_.isNaN(t))&&(n=o(moment().add(-1,"days"))),n&&i.push("expires="+o(n)),r&&i.push("path="+r),document.cookie=i.join("; ")},(e=e||{}).Cookies=n,window.App=e}(window.App),function(e,t){var n={};function r(){var e;try{e=JSON.parse(localStorage.cookies)}catch(t){e=null}return e&&_.isObject(e)&&!_.isArray(e)?e:{}}var o=_.throttle((function(){var e=r(),t=0;return _.chain(e).filter((function(e){return!moment().isBefore(e.Expires)})).each((function(n,r){t++,delete e[r]})),t&&(localStorage.cookies=JSON.stringify(e)),_.reduce(e,(function(e,t,n){return e[n]=t.Value,e}),{})}),500);n.KeyExists=function(e){return _.has(o(),e)},n.Delete=function(e){if(n.KeyExists(e)){var t=r();delete t[e],localStorage.cookies=JSON.stringify(t)}},n.Get=function(e){if(!n.KeyExists(e))throw"Key not set: "+e;return o()[e]},n.Set=function(e,t,n,o){var i=r();return i[e]={Value:t,Expires:n,Path:o},localStorage.cookies=JSON.stringify(i),!0},(e=e||{}).LocalStorage=n,window.App=e}(window.App),function(e,t){var n=e.App||{};n.CurrentAssignment=null,n.Store={},$((function(){n.Store=n.SupportsLocalStorage()?n.LocalStorage:n.Cookies;var e=0,t=_.debounce((function(){e=0}),1e3);$(document).on("keydown",(function(n){t(),String.fromCharCode(n.which).toLowerCase()==="where the answers at".substr(e,1)?e++:e=0,e<"where the answers at".length||(e=0,$(".correct").closest(".list-group-item").toggleClass("correct-show"))})).on("click",(function(){var e=_.map($("input:checked"),(function(e){return $(e).attr("id")}));n.Store.Set(n.CurrentAssignment,e,moment().add(30,"days"))}))})),n.CheckAnswers=function(){var e=_.size($("input.correct")),t=_.size($("input:checked")),n=_.size($("input.correct:checked"));t===e?$(".score").html(n+"/"+e+" &ndash; "+(n/e*100).toFixed(2)+"%<br /><small>Final</small>"):$(".score").html("Attempted: "+n+"/"+t+" &ndash; "+(n/t*100||0).toFixed(2)+"%<br /><small>Total: "+n+"/"+e+" &ndash; "+(n/e*100).toFixed(2)+"%</small>")},n.GetQueryParams=_.once((function(){for(var e,t=/(?:[\?&])(.+)=(.+)/g,n={};(e=t.exec(document.location.search))&&e;)n[e[1]]=e[2];return n})),n.FromQuery=function(e){return n.GetQueryParams()[e]},n.Load=function(e){return e=_.isString(e)?e:n.FromQuery("load"),n.CurrentAssignment="assignment_"+e,Promise.resolve($.ajax("Assignments/"+e+".md",{contentType:"text/plain"})).then((function(e){var t=marked(e),n=$("#main-body");n.html(t),document.title=$(t).filter("h1").first().text()||"Assignment",_.chain(["lang","language"]).map((function(e){return _.map(["cs","js"],(function(t){return[e,t].join("-")}))})).each((function(e){n.find(".".concat(e)).each((function(t,n){var r=$(n),o=r.closest("pre"),i=r.html();o.html(i).addClass("prettyprint ".concat(e)),_.size(i.trim().split("\n"))>5&&o.addClass("linenums"),r.remove()}))})),n.find(".lang-console").each((function(e,t){var n=$(t),r=n.closest("pre"),o=n.html();o=(o=o.replace(/^(\s*)@(.*)$/gm,'$1<span class="input">$2</span>')).replace(/^(\s*)(?:>|&gt;)(.*)$/gm,'$1<span class="typewriter">$2</span>'),r.html(o).addClass("console"),n.remove()})),n.find("blockquote").each((function(e,t){var n=$(t),r=n.find("p"),o=$("<ul class='list-group answers'></ul>"),i=r.html().split("\n");_.each(i,(function(e){var t=$("<li class='list-group-item'><div class='radio'><label><input type='radio' /></label></div></li>");0===e.indexOf("!")&&(t.find("input").addClass("correct"),e=e.substr(1).trim()),t.find("label").append(e),o.append(t)})),o.insertBefore(n),n.remove()})),prettyPrint()})).then(n.WireUpQuestions).then(n.RestoreAnswers).caught((function(){$("#main-body").html("<h1 class='page-header'>Assignment</h1><div class='alert alert-info'><strong>Not found</strong> No assignment could be found. It was either removed or hasn't been created yet.</div>"),$(".well").hide()}))},n.RestoreAnswers=function(){if(n.Store.KeyExists(n.CurrentAssignment)){var e=n.Store.Get(n.CurrentAssignment);_.each(e,(function(e){$("#"+e).attr("checked","checked")})),n.CheckAnswers()}},n.SupportsLocalStorage=_.once((function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}})),n.WireUpQuestions=function(){$(document).on("click","input[type='radio'], input[type='check']",n.CheckAnswers),$(".answers").each((function(e,t){$(t).find("input[type='radio'], input[type='check']").each((function(t,n){$(n).attr("name","q"+e).attr("id",_.uniqueId("choice"))}))}))},e.App=n}(window);